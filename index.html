<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>ë¸Œë¦­ ë¸Œë ˆì´ì»¤ íŒŒìŠ¤í…” (ëª¨ë°”ì¼)</title>
<style>
  :root{
    --bg:#f5f5fa; --fg:#444; --accent:#ffa7c4;
    --brick1:#ffd6a5; --brick2:#caffbf; --brick3:#9bf6ff; --brick4:#a0c4ff; --brick5:#bdb2ff; --paddle:#ffadad;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--fg);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',sans-serif;
    display:flex;flex-direction:column;align-items:center;gap:12px;padding:16px;
  }
  header{width:100%;max-width:900px;display:flex;justify-content:space-between;align-items:center;gap:8px}
  .hud{display:flex;gap:8px;font-weight:700;flex-wrap:wrap}
  .chip{background:#fff;padding:6px 12px;border-radius:20px;box-shadow:0 1px 3px rgba(0,0,0,.1)}
  .panel{width:100%;max-width:900px;display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap}
  .btn{padding:8px 14px;border-radius:20px;border:none;cursor:pointer;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,.1);font-weight:800}
  .note{font-size:13px;opacity:.85}
  .wrap{
    width:100%;max-width:900px;aspect-ratio:16/9;border-radius:14px;overflow:hidden;background:#fff;
    box-shadow:0 6px 12px rgba(0,0,0,.1);position:relative;touch-action:none; /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤ ë°©ì§€ */
  }
  canvas{width:100%;height:100%;display:block;background:transparent}
  .center-msg{
    position:absolute;inset:0;display:grid;place-items:center;font-weight:800;color:var(--fg);text-align:center;
    font-size:18px;background:rgba(255,255,255,.6);padding:12px
  }
  .hidden{display:none}

  /* â†“ ëª¨ë°”ì¼ ì „ìš© ì¢Œ/ìš° í° í„°ì¹˜ë²„íŠ¼ */
  .touch-controls{
    position:absolute;left:0;right:0;bottom:0;display:flex;gap:8px;padding:8px;
    justify-content:space-between;pointer-events:none; /* ë‚´ë¶€ ë²„íŠ¼ë§Œ í„°ì¹˜ */
  }
  .touch-btn{
    pointer-events:auto;flex:1;min-height:56px;border:none;border-radius:12px;
    background:rgba(0,0,0,.08);font-size:18px;font-weight:900;color:#333;
    backdrop-filter:blur(4px)
  }
  @media (max-width:520px){
    .chip{padding:6px 10px}
    header h2{font-size:18px;margin:0}
  }
</style>
</head>
<body>
  <header>
    <h2>ğŸ§± ë¸Œë¦­ ë¸Œë ˆì´ì»¤ íŒŒìŠ¤í…”</h2>
    <div class="hud">
      <div class="chip">ì ìˆ˜ <span id="score">0</span></div>
      <div class="chip">ìŠ¤í…Œì´ì§€ <span id="stage">1</span></div>
      <div class="chip">ëª©ìˆ¨ <span id="lives">3</span></div>
    </div>
  </header>

  <section class="panel">
    <span class="note">â† â†’ / A D, SpaceÂ·íƒ­ìœ¼ë¡œ ì‹œì‘Â·ì¼ì‹œì •ì§€ Â· í™”ë©´ ë“œë˜ê·¸/ë²„íŠ¼ìœ¼ë¡œ ì´ë™</span>
    <div>
      <button id="startBtn" class="btn">â–¶ ì‹œì‘/ì¼ì‹œì •ì§€</button>
      <button id="resetBtn" class="btn">âŸ³ ë¦¬ì…‹</button>
    </div>
  </section>

  <div class="wrap" id="wrap">
    <canvas id="game" width="900" height="506"></canvas>
    <div id="msg" class="center-msg">íƒ­(ë˜ëŠ” Space)ìœ¼ë¡œ ì‹œì‘!<br/>í™”ë©´ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.</div>

    <!-- ëª¨ë°”ì¼ í° í„°ì¹˜ë²„íŠ¼ -->
    <div class="touch-controls">
      <button class="touch-btn" id="leftBtn">â—€ ì™¼ìª½</button>
      <button class="touch-btn" id="rightBtn">ì˜¤ë¥¸ìª½ â–¶</button>
    </div>
  </div>

<script>
(() => {
  const c = document.getElementById('game');
  const ctx = c.getContext('2d');
  const wrap = document.getElementById('wrap');
  const msgEl = document.getElementById('msg');
  const scoreEl = document.getElementById('score');
  const stageEl = document.getElementById('stage');
  const livesEl = document.getElementById('lives');
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');

  // DPR ìŠ¤ì¼€ì¼ë§(ì„ ëª…ë„)
  function fitCanvas(){
    const dpr = Math.max(1, Math.floor(window.devicePixelRatio || 1));
    const rect = c.getBoundingClientRect();
    c.width = Math.round(rect.width * dpr);
    c.height = Math.round(rect.height * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0); // ë…¼ë¦¬ ì¢Œí‘œë¥¼ CSS í”½ì…€ê³¼ ë™ì¼í•˜ê²Œ
  }
  new ResizeObserver(fitCanvas).observe(wrap);
  window.addEventListener('orientationchange', ()=>setTimeout(fitCanvas, 100));

  let running=false, over=false;
  let score=0, stage=1, lives=3;

  const paddle = {w:110,h:14,x:0,y:0,speed:8};
  const ball = {x:0,y:0,r:8,vx:4,vy:-4};
  const conf = {rows:5,cols:10,h:20,pad:8,top:60,side:30};
  let bricks=[];

  const colors=['var(--brick1)','var(--brick2)','var(--brick3)','var(--brick4)','var(--brick5)'];

  function buildStage(){
    bricks=[];
    const bw = (c.width - conf.side*2 - (conf.cols-1)*conf.pad) / conf.cols;
    for(let r=0;r<conf.rows;r++){
      for(let i=0;i<conf.cols;i++){
        bricks.push({x:conf.side+i*(bw+conf.pad), y:conf.top+r*(conf.h+conf.pad), w:bw, h:conf.h, color:colors[r%colors.length]});
      }
    }
  }

  function resetGame(){
    fitCanvas();
    score=0;stage=1;lives=3;
    scoreEl.textContent=score;stageEl.textContent=stage;livesEl.textContent=lives;
    paddle.x=c.width/2 - paddle.w/2; paddle.y=c.height - 30;
    ball.x=c.width/2; ball.y=c.height - 60; ball.vx=4; ball.vy=-4;
    buildStage();
    running=false;over=false;
    msgEl.textContent="íƒ­(ë˜ëŠ” Space)ìœ¼ë¡œ ì‹œì‘!"; msgEl.classList.remove('hidden');
  }

  function toggleRun(){
    if(over){ resetGame(); return; }
    running=!running;
    msgEl.classList.toggle('hidden', running);
    if(!running && !over) msgEl.textContent="ì¼ì‹œì •ì§€ (íƒ­/Spaceë¡œ ì¬ì‹œì‘)";
  }

  document.getElementById('startBtn').onclick=toggleRun;
  document.getElementById('resetBtn').onclick=resetGame;

  // í‚¤ë³´ë“œ
  let left=false,right=false;
  document.addEventListener('keydown',e=>{
    if(e.code==="Space"){ e.preventDefault(); toggleRun(); }
    if(e.key==="ArrowLeft"||e.key==="a"||e.key==="A") left=true;
    if(e.key==="ArrowRight"||e.key==="d"||e.key==="D") right=true;
  });
  document.addEventListener('keyup',e=>{
    if(e.key==="ArrowLeft"||e.key==="a"||e.key==="A") left=false;
    if(e.key==="ArrowRight"||e.key==="d"||e.key==="D") right=false;
  });

  // í™”ë©´ íƒ­ìœ¼ë¡œ ì‹œì‘/ì¼ì‹œì •ì§€
  wrap.addEventListener('pointerdown', (e)=>{
    // í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ì€ ë²„íŠ¼ ìì²´ê°€ ì²˜ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„  ì‹œì‘/ì¼ì‹œì •ì§€ í† ê¸€ë§Œ
    if(e.target === leftBtn || e.target === rightBtn) return;
    toggleRun();
  });

  // ë“œë˜ê·¸ë¡œ íŒ¨ë“¤ ì´ë™
  let dragging=false;
  wrap.addEventListener('pointerdown', (e)=>{ dragging=true; movePaddle(e); });
  wrap.addEventListener('pointermove', (e)=>{ if(dragging) movePaddle(e); });
  wrap.addEventListener('pointerup', ()=> dragging=false);
  function movePaddle(e){
    const rect = c.getBoundingClientRect();
    const x = (e.clientX - rect.left);
    paddle.x = Math.max(0, Math.min(c.width - paddle.w, x - paddle.w/2));
  }

  // í° í„°ì¹˜ë²„íŠ¼ìœ¼ë¡œ ì´ë™(ê¸¸ê²Œ ëˆ„ë¥´ë©´ ê³„ì† ì´ë™)
  function bindHold(btn, dir){
    let hold=false, rafId=null;
    const step=()=>{ if(!hold) return; paddle.x += dir*paddle.speed*1.2; clampPaddle(); rafId=requestAnimationFrame(step); };
    const onDown=()=>{ hold=true; step(); };
    const onUp=()=>{ hold=false; if(rafId) cancelAnimationFrame(rafId); };
    btn.addEventListener('pointerdown', onDown);
    btn.addEventListener('pointerup', onUp);
    btn.addEventListener('pointerleave', onUp);
  }
  bindHold(leftBtn, -1);
  bindHold(rightBtn, 1);

  function clampPaddle(){ paddle.x = Math.max(0, Math.min(c.width - paddle.w, paddle.x)); }

  function update(){
    if(left) paddle.x -= paddle.speed;
    if(right) paddle.x += paddle.speed;
    clampPaddle();

    ball.x+=ball.vx; ball.y+=ball.vy;

    // ë²½ ë°˜ì‚¬
    if(ball.x<ball.r){ ball.x=ball.r; ball.vx*=-1; }
    if(ball.x>c.width-ball.r){ ball.x=c.width-ball.r; ball.vx*=-1; }
    if(ball.y<ball.r){ ball.y=ball.r; ball.vy*=-1; }

    // íŒ¨ë“¤
    if(ball.y+ball.r>=paddle.y && ball.x>paddle.x && ball.x<paddle.x+paddle.w){
      ball.vy*=-1;
      const hit = (ball.x-(paddle.x+paddle.w/2))/(paddle.w/2);
      ball.vx = 5*hit;
      ball.y = paddle.y - ball.r;
    }

    // ë²½ëŒ
    for(let i=0;i<bricks.length;i++){
      const b=bricks[i];
      if(ball.x> b.x && ball.x<b.x+b.w && ball.y-ball.r<b.y+b.h && ball.y+ball.r> b.y){
        ball.vy*=-1;
        bricks.splice(i,1);
        score+=10; scoreEl.textContent=score;
        break;
      }
    }

    // ë°”ë‹¥
    if(ball.y>c.height){
      lives--; livesEl.textContent=lives;
      if(lives<=0){
        over=true; running=false; msgEl.textContent="ê²Œì„ ì˜¤ë²„! Space/íƒ­ìœ¼ë¡œ ì¬ì‹œì‘"; msgEl.classList.remove('hidden');
      }else{
        ball.x=c.width/2; ball.y=c.height-60; ball.vx=4; ball.vy=-4;
        paddle.x=c.width/2 - paddle.w/2;
        running=false; msgEl.textContent="ì¬ë„ì „! Space/íƒ­ìœ¼ë¡œ ì‹œì‘"; msgEl.classList.remove('hidden');
      }
    }

    // í´ë¦¬ì–´
    if(bricks.length===0){
      stage++; stageEl.textContent=stage;
      conf.rows++; buildStage();
      ball.x=c.width/2; ball.y=c.height-60;
      running=false; msgEl.textContent=`ìŠ¤í…Œì´ì§€ ${stage-1} í´ë¦¬ì–´! Space/íƒ­ìœ¼ë¡œ ê³„ì†`; msgEl.classList.remove('hidden');
    }
  }

  function draw(){
    ctx.clearRect(0,0,c.width,c.height);
    // ë²½ëŒ
    bricks.forEach(b=>{ ctx.fillStyle=b.color; ctx.fillRect(b.x,b.y,b.w,b.h); });
    // íŒ¨ë“¤
    ctx.fillStyle='var(--paddle)'; ctx.fillRect(paddle.x,paddle.y,paddle.w,paddle.h);
    // ê³µ
    ctx.beginPath(); ctx.fillStyle='var(--accent)'; ctx.arc(ball.x,ball.y,ball.r,0,Math.PI*2); ctx.fill();
  }

  function loop(){ if(running) update(); draw(); requestAnimationFrame(loop); }

  resetGame();
  loop();
})();
</script>
</body>
</html>
